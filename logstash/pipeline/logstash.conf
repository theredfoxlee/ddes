input {
  beats {
    port => 5044
  }
}

filter {
  if [log][file][path] == "/files/idoc_idoc.csv" {
    csv {
      columns => ["Technical name", "Description", "Value", "Table"]
      separator => ","
    }
  }
  else if [log][file][path] == "/files/powerbi_link_activity.csv" {
    csv {
      columns => ["Call No", "Infra Link", "Log Date"]
      separator => ","
    }
  }
  else if [log][file][path] == "/files/powerbi_requestor_activity.csv" {
    csv {
      columns => ["Call No", "Requestor", "Log Date"]
      separator => ","
    }
  }
  else if [log][file][path] == "/files/powerbi_statuses.csv" {
    csv {
      columns => ["Call No", "Status"]
      separator => ","
    }
  }

  mutate {
    add_field => {"file" => "%{[log][file][path]}"}
    remove_field => ["message", "input", "tags", "ecs", "agent", "host", "log"]
  }
}

output {
  if [file] == "/files/idoc_idoc.csv" or 
     [file] == "/files/powerbi_link_activity.csv" or
     [file] == "/files/powerbi_requestor_activity.csv" or
     [file] == "/files/powerbi_statuses.csv" {
    elasticsearch {
      hosts => "elasticsearch:9200"
    }
  } else {
    stdout {
      codec => rubydebug
    }
  }
}
